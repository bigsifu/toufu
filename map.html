<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>百度地图 - 黄冈市黄州区街道乡镇范围 (初始比例约2km)</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
        body, html, #map_container {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: "微软雅黑", sans-serif;
        }
        /* 隐藏百度logo文字链接 */
        .BMap_cpyCtrl span, .anchorBL a {
            display: none !important;
        }
        /* (可选) 提示信息样式 */
        #infoPanel {
             position: absolute;
             bottom: 30px; /* 调整位置，避免挡住比例尺 */
             left: 10px;
             background-color: rgba(255, 255, 255, 0.8);
             padding: 5px 10px;
             border-radius: 3px;
             font-size: 12px;
             z-index: 10;
         }
    </style>
    <!-- 1. Load Baidu Maps JavaScript API - 使用您提供的AK -->
    <script type="text/javascript" src="//api.map.baidu.com/api?v=3.0&ak=GrmGwPn6ihBEV1MHRtyozXm4kpUuGf6F"></script>
</head>
<body>
    <!-- 2. Map container -->
    <div id="map_container"></div>
    <!-- (可选) 信息提示面板 -->
    <div id="infoPanel">正在加载地图和边界数据...</div>

    <script type="text/javascript">
        var infoPanel = document.getElementById('infoPanel');

        if (typeof BMap !== "undefined" && BMap.Map) {
            var map = new BMap.Map("map_container");

            // --- 设置地图中心点和初始缩放级别 ---
            // 黄州区的大致中心经纬度 (可以根据实际情况微调)
            var centerPoint = new BMap.Point(114.885, 30.455); // 大约在黄州区政府附近
            // 尝试设置Zoom Level 14, 在此纬度下比例尺可能接近2km
            // 您可以调整这个值 (13 或 15) 来观察比例尺变化
            var initialZoom = 14;
            map.centerAndZoom(centerPoint, initialZoom);

            map.enableScrollWheelZoom(true);
            map.enableContinuousZoom(true);
            map.addControl(new BMap.NavigationControl());
            // 将比例尺放在左下角
            map.addControl(new BMap.ScaleControl({ anchor: BMAP_ANCHOR_BOTTOM_LEFT }));
            // 不再需要概览图，因为我们只关注黄州区
            // map.addControl(new BMap.OverviewMapControl());

             // --- 获取"黄冈市黄州区"整体边界用于创建遮罩 ---
            var boundary = new BMap.Boundary();
            var huangzhouDistrictName = "黄冈市黄州区";

            boundary.get(huangzhouDistrictName, function(districtResult) {
                if (districtResult && districtResult.boundaries && districtResult.boundaries.length > 0) {
                    console.log("成功获取到 " + huangzhouDistrictName + " 的整体边界。");
                    infoPanel.innerHTML = "正在绘制高亮区域和街道乡镇边界...";

                    // --- 创建外部遮罩效果 (同上一个例子) ---
                    var outerBoundary = [
                        new BMap.Point(-180, -90), new BMap.Point(180, -90),
                        new BMap.Point(180, 90), new BMap.Point(-180, 90)
                    ];
                    var huangzhouPoints = [];
                    districtResult.boundaries.forEach(function(boundaryStr) {
                        var points = boundaryStr.split(';').map(function(ptStr) {
                            var parts = ptStr.split(',');
                            return new BMap.Point(parseFloat(parts[0]), parseFloat(parts[1]));
                        });
                        huangzhouPoints.push(points);
                    });

                    var maskPoints = [outerBoundary].concat(huangzhouPoints);
                    var maskPolygon = new BMap.Polygon(maskPoints, {
                        fillColor: "#808080",
                        fillOpacity: 0.6, // 可以稍微调高一点不透明度
                        strokeWeight: 0,
                        strokeColor: "none"
                    });
                    map.addOverlay(maskPolygon);
                    console.log("黄州区外部遮罩已添加。");

                    // --- 绘制黄州区下辖各街道乡镇的边界 ---
                    drawSubUnits();

                } else {
                    console.error("未能获取到 '" + huangzhouDistrictName + "' 的整体边界，无法创建高亮效果。");
                    infoPanel.innerHTML = "错误：无法获取黄州区边界，无法高亮。正在尝试加载街道乡镇...";
                    // 即使无法高亮，也尝试绘制街道乡镇
                    drawSubUnits();
                }
            });

            // --- 绘制黄州区下辖街道乡镇边界的函数 ---
            function drawSubUnits() {
                // 黄州区主要街道、乡、镇列表 (请根据实际情况核对或调整)
                var subUnits = [
                    "黄冈市黄州区赤壁街道", "黄冈市黄州区东湖街道", "黄冈市黄州区禹王街道",
                    "黄冈市黄州区南湖街道", "黄冈市黄州区路口镇", "黄冈市黄州区堵城镇",
                    "黄冈市黄州区陈策楼镇", "黄冈市黄州区陶店乡"
                ];
                // 使用不同的、鲜明的颜色
                var colors = ["#1f78b4", "#33a02c", "#e31a1c", "#ff7f00", "#6a3d9a",
                              "#b15928", "#a6cee3", "#b2df8a", "#fb9a99", "#fdbf6f"];
                var colorIndex = 0;
                var loadedCount = 0;
                var totalUnits = subUnits.length;

                subUnits.forEach(function(unitName) {
                    var currentStrokeColor = colors[colorIndex % colors.length];
                    var currentFillColor = colors[colorIndex % colors.length];
                    colorIndex++;

                    boundary.get(unitName, function(result) {
                        loadedCount++;
                        if (result && result.boundaries && result.boundaries.length > 0) {
                            console.log("获取到 " + unitName + " 边界");
                            var boundaryCount = result.boundaries.length;
                            for (var i = 0; i < boundaryCount; i++) {
                                var polygon = new BMap.Polygon(result.boundaries[i], {
                                    strokeWeight: 2,
                                    strokeColor: currentStrokeColor, // 边框用醒目颜色
                                    strokeOpacity: 0.9,
                                    fillColor: currentFillColor,     // 填充用同色
                                    fillOpacity: 0.25       // 填充透明度，以便看清底图
                                });
                                map.addOverlay(polygon);
                            }
                        } else {
                            console.warn("未能获取到 '" + unitName + "' 的边界数据。名称可能不准确或无数据。");
                        }

                        // 更新加载提示
                        if (loadedCount === totalUnits) {
                             infoPanel.innerHTML = "黄州区街道乡镇边界加载完成。";
                             setTimeout(function() { infoPanel.style.display = 'none'; }, 3000);
                        } else {
                             infoPanel.innerHTML = `正在加载街道乡镇边界 (${loadedCount}/${totalUnits})...`;
                        }
                    });
                });
                console.log("已开始请求所有街道乡镇的边界数据...");
            }

        } else {
            // Critical Error
            var errorMsg = "错误：BMap API 未能成功加载！";
            console.error(errorMsg + "请检查AK、网络及浏览器控制台(F12)。");
            alert(errorMsg);
            infoPanel.innerHTML = errorMsg;
            document.getElementById('map_container').innerHTML = '<div style="padding: 20px; text-align: center; color: red;">' + errorMsg + '<br>请确认API密钥(AK)正确，网络通畅，并检查浏览器控制台(F12)。</div>';
        }
    </script>
</body>
</html>
